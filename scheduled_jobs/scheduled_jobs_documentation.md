# Scheduled Jobs Documentation

By default, Heroku applications make requests from an unpredictable and impermanent set of IP addresses. Unfortunately, the Brawl Stars API (https://developer.brawlstars.com) requires a set of fixed IP addresses where requests are allowed to come from. This challenge is solved with the add-on Fixie (https://devcenter.heroku.com/articles/fixie). It provides Heroku applications with a fixed set of static IP addresses for outbound requests.

The Fixie free tier allows 500 requests per month (approximately 125 requests per week) and 100 MB data transfer per month. This means, the scripts `get_club_members.py` and `get_club_league_games.py` cannot be executed too frequently from within Heroku, as otherwise the 500 requests would be used before end of month. Therefore, it was decided to execute the `get_club_members.py` script every Wednesday 30 minutes before the Club League season starts (which is at 13:30 UTC, as the Club League season starts at 14:00 UTC). The `get_club_league_games.py` script is executed every Thursday, Saturday and Monday 30 minutes after the Club League event day ends (which is at 14:30 UTC). This should be sufficient to retrieve all Club League Power Matches from the battlelogs.

To put it in other words, the `get_club_members.py` script performs one request every Wednesday and the `get_club_league_games.py` script performs 30 requests (one per club member) every Thursday, Saturday and Monday. This adds up to 91 requests per week and is below the threshold of 125. The data transfer of the requests is so minimal that the 100 MB per month will not be reached.

The execution of the scripts is scheduled with the free Heroku Scheduler (https://devcenter.heroku.com/articles/scheduler). There are some limitations, as the Scheduler can only execute a command every 10 minutes, hourly or daily. These scheduling options do not match with the desired execution schedule outlined above. To solve this, the Scheduler is set to execute the `get_club_members.py` script every day at 13:30 UTC and the `get_club_league_games.py` script every day at 14:30 UTC. In the code of both scripts, there is an if condition which runs the request part of the script only if it is a Wednesday for the `get_club_members.py` script and if it is a Thursday, Saturday or Monday for the `get_club_league_games.py` script.
